# Image Master PRD (Product Requirements Document)

## 문서 정보
- **버전**: 2.3
- **원본 기반**: Image Master 개발 계획서 v1.0 (2025.12.25)
- **UI 프레임워크**: React (원본 Svelte에서 변경)
- **최종 업데이트**: 2026.01.13

---

## 1. 개요

### 1.1 프로젝트 목표
Obsidian 사용자의 이미지 관리 경험을 통합하는 올인원 플러그인 개발

### 1.2 핵심 철학
- **하이브리드**: 로컬 저장 보안성 + 클라우드 편의성 (클라우드는 Post-MVP)
- **올인원**: 저장, 관리, 검색, 정리를 하나의 플러그인에서 해결
- **사용자 중심**: 즉시 사용 가능한 기본값 + 고급 커스터마이징 제공

---

## 2. MVP 기능 명세

### 2.1 안정적인 로컬 파일 관리
| 항목 | 상세 |
|------|------|
| 자동 저장 | 붙여넣기/드래그 시 설정된 경로로 자동 저장 |
| 경로 패턴 | `{vault}/attachments/{year}/{month}/{filename}` 등 커스텀 |
| 파일명 패턴 | `{timestamp}_{original}`, `{uuid}` 등 지원 |
| 링크 자동 업데이트 | 파일 이동/이름 변경 시 모든 참조 링크 갱신 |

### 2.2 통합 이미지 갤러리
| 항목 | 상세 |
|------|------|
| 뷰 모드 | 그리드 뷰 / 리스트 뷰 전환 지원 |
| 썸네일 뷰 | 그리드 레이아웃, 가상화 스크롤링 (대용량 대응) |
| 리스트 뷰 | 테이블 형식, 컬럼 정렬 (이름/크기/날짜/폴더) |
| 드래그 & 드롭 | 갤러리 → 에디터로 이미지 삽입 |
| 역참조 | 이미지 클릭 시 사용 중인 노트 목록 표시 |
| 필터 탭 | 전체 / 사용 중 / 고아 이미지 분류 (개수 표시) |
| 다중 선택 | Ctrl+클릭(토글), Shift+클릭(범위), Ctrl+A(전체) |
| 벌크 작업 | 선택 이미지 일괄 삭제/이동 (ActionToolbar) |
| 정렬 | 이름, 크기, 생성일, 수정일, 폴더별 정렬 |

### 2.3 지능형 중복 감지
| 항목 | 상세 |
|------|------|
| 해시 알고리즘 | SHA-256 (Node.js crypto) |
| 동작 | 동일 해시 발견 시 기존 이미지 링크 재사용 |
| 알림 | 중복 감지 시 사용자에게 토스트 알림 |

### 2.4 스마트 삭제
| 항목 | 상세 |
|------|------|
| 고아 감지 | 어떤 노트에서도 참조되지 않는 이미지 자동 분류 |
| 삭제 워크플로우 | 고아 탭에서 확인 → 선택 → 영구 삭제 |
| 안전장치 | 삭제 전 확인 다이얼로그, 되돌리기 불가 경고 |

### 2.5 정보 패널 & 빠른 액션
| 항목 | 상세 |
|------|------|
| 메타데이터 | 파일명, 크기, 해상도, 포맷, 생성일, 연결 노트 |
| 빠른 액션 | 파일 위치 열기, 이름 변경, 클립보드 복사, 삭제 |

---

## 3. 이미지 저장 구조 및 노트 연동 전략

이 섹션은 플러그인의 핵심 설계 결정사항으로, 이미지 파일 저장 위치와 노트 변경 시 동작을 정의합니다.

### 3.1 폴더 구조 전략

#### 지원하는 저장 모드

| 모드 | 설명 | 예시 경로 | 장단점 |
|------|------|-----------|--------|
| **폴더 기반** (기본값) | 노트 폴더 내에 `{폴더명}_img` 서브폴더 생성 | `notes/project/project_img/image.png` | 폴더별 이미지 그룹핑, 적절한 분산 |
| **중앙 집중형** | 모든 이미지를 단일 폴더에 저장 | `attachments/image.png` | 관리 용이, 노트 이동 영향 없음 |
| **날짜 기반** | 연/월 하위 폴더로 분류 | `attachments/2026/01/image.png` | 시간순 정리, 대용량 Vault에 적합 |
| **노트 동일 위치** | 노트와 같은 폴더에 저장 | `notes/project/image.png` | 노트별 자급자족, 이동 시 함께 이동 |
| **노트명 폴더** | 노트 이름으로 하위 폴더 생성 | `attachments/MyNote/image.png` | 노트별 이미지 그룹핑 |

#### 기본 폴더 구조 (권장 - 폴더 기반 모드)

```
Vault/
├── notes/
│   ├── project/
│   │   ├── project_img/            # 폴더명_img 형식의 이미지 폴더
│   │   │   ├── 20260112_screenshot.png
│   │   │   └── 20260112_diagram.png
│   │   ├── ProjectNote.md
│   │   └── AnotherNote.md
│   └── personal/
│       ├── personal_img/           # 각 폴더마다 별도 이미지 폴더
│       │   └── photo.png
│       └── Diary.md
├── _orphaned/                      # 고아 이미지 임시 보관 (Vault 루트)
└── .image-master/                  # 플러그인 메타데이터
    ├── hash-cache.json             # 해시 캐시
    └── thumbnail-cache/            # 썸네일 캐시
```

#### 폴더 기반 모드 상세 동작

1. **이미지 폴더 명명 규칙**: `{부모폴더명}_img`
   - `notes/project/` → `notes/project/project_img/`
   - `work/meetings/` → `work/meetings/meetings_img/`

2. **Vault 루트의 노트**: 루트에 노트가 있으면 `_img/` 폴더 사용
   - `Vault/RootNote.md` → `Vault/_img/image.png`

3. **이미지 폴더 자동 생성**: 첫 이미지 추가 시 자동으로 `{폴더명}_img` 폴더 생성

4. **이미지 폴더 접미사 커스터마이징**: 설정에서 `_img` 대신 `_assets`, `_attachments` 등 변경 가능

### 3.2 파일명 규칙

#### 지원하는 파일명 패턴

| 패턴 | 형식 | 예시 | 용도 |
|------|------|------|------|
| `original` | 원본 파일명 유지 | `screenshot.png` | 의미 있는 파일명 보존 |
| `timestamp` | 날짜시간 접두사 | `20260112_143052_screenshot.png` | 시간순 정렬, 충돌 방지 |
| `uuid` | 고유 ID | `a1b2c3d4.png` | 완전한 충돌 방지 |
| `hash` | 내용 해시 (앞 8자리) | `abcd1234.png` | 중복 파일 동일 이름 |
| `custom` | 사용자 정의 패턴 | `{note}_{timestamp}_{original}` | 유연한 커스터마이징 |

#### 커스텀 패턴 변수

```
{original}   - 원본 파일명 (확장자 제외)
{ext}        - 확장자
{timestamp}  - YYYYMMdd_HHmmss
{date}       - YYYY-MM-DD
{year}       - YYYY
{month}      - MM
{day}        - DD
{uuid}       - 8자리 UUID
{hash}       - 8자리 SHA-256
{note}       - 현재 노트 이름
{folder}     - 현재 노트 폴더명
{counter}    - 자동 증가 번호 (충돌 시)
```

#### 파일명 충돌 처리

1. 동일 파일명 존재 시 → `{filename}_{counter}.{ext}` 형식으로 자동 변경
2. 예: `image.png` → `image_1.png` → `image_2.png`

### 3.3 노트 변경 시 영향 및 처리 전략

#### 시나리오 1: 노트 이름 변경

| 저장 모드 | 영향 | 플러그인 동작 |
|-----------|------|---------------|
| **폴더 기반** (기본값) | 없음 | 처리 불필요 (폴더명 기준이므로) |
| 중앙 집중형 | 없음 | 처리 불필요 |
| 날짜 기반 | 없음 | 처리 불필요 |
| 노트명 폴더 | **이미지 폴더명 변경 필요** | 자동으로 폴더명 변경 + 모든 링크 업데이트 |
| 노트 동일 위치 | 없음 | 처리 불필요 |

#### 시나리오 2: 노트 폴더 이동

| 저장 모드 | 영향 | 플러그인 동작 |
|-----------|------|---------------|
| **폴더 기반** (기본값) | **이미지 폴더도 새 위치에 생성 필요** | 옵션에 따라 처리 |
| 중앙 집중형 | 없음 | 처리 불필요 |
| 날짜 기반 | 없음 | 처리 불필요 |
| 노트명 폴더 | 없음 (이미지는 중앙에) | 처리 불필요 |
| 노트 동일 위치 | **이미지도 함께 이동 필요** | 옵션에 따라 처리 |

#### 시나리오 3: 노트 삭제

| 동작 | 설명 |
|------|------|
| 즉시 삭제 안 함 | 노트 삭제 시 이미지 즉시 삭제하지 않음 |
| 고아 상태 전환 | 해당 이미지들이 다른 노트에서 참조되지 않으면 "고아" 상태로 분류 |
| 사용자 확인 후 삭제 | 갤러리의 고아 탭에서 사용자가 직접 영구 삭제 결정 |

### 3.4 링크 형식 전략

#### Obsidian 링크 형식 지원

| 형식 | 예시 | 특징 |
|------|------|------|
| **위키링크 (기본)** | `![[image.png]]` | Obsidian 네이티브, 파일명만으로 참조 |
| **위키링크 + 경로** | `![[attachments/image.png]]` | 명시적 경로, 동명 파일 구분 |
| **마크다운 상대** | `![](./attachments/image.png)` | 마크다운 호환, 상대 경로 |
| **마크다운 절대** | `![](/attachments/image.png)` | Vault 루트 기준 |

#### 설정별 권장 링크 형식

| 저장 모드 | 권장 링크 형식 | 이유 |
|-----------|----------------|------|
| **폴더 기반** (기본값) | 위키링크 + 경로 | 폴더별 구분 명확, 자동 업데이트 지원 |
| 중앙 집중형 | 위키링크 (파일명만) | 경로 무관하게 동작 |
| 날짜 기반 | 위키링크 + 경로 | 동명 파일 구분 필요 |
| 노트 동일 위치 | 마크다운 상대 경로 | 노트 이동 시 함께 이동 |
| 노트명 폴더 | 위키링크 + 경로 | 폴더 변경 시 자동 업데이트 |

---

## 4. 기술 스택

| 구분 | 기술 | 비고 |
|------|------|------|
| 언어 | TypeScript | Obsidian 공식 권장 |
| UI | **React** | 원본(Svelte)에서 변경 - 생태계/재사용성 우선 |
| 빌드 | esbuild | Obsidian 표준 빌드 도구 |
| 해시 | Node.js crypto | SHA-256 중복 감지 |
| 스타일 | CSS | 스코프 격리 |

### 4.1 React 선택 근거
- 풍부한 생태계 및 컴포넌트 라이브러리
- 팀 친숙도 및 학습 자료 풍부
- react-virtualized 등 대용량 리스트 처리 라이브러리 활용 가능
- Obsidian 커뮤니티에서도 React 플러그인 다수 존재

### 4.2 Obsidian API 활용
| API | 용도 |
|-----|------|
| Vault API | 파일 CRUD, 이벤트 감지 |
| Workspace API | 커스텀 뷰 등록 |
| MetadataCache API | 노트-이미지 링크 분석 |
| Editor API | 에디터에 링크 삽입 |

---

## 5. 프로젝트 구조

```
star-imagemaster/
├── src/
│   ├── main.ts                 # 플러그인 엔트리
│   ├── settings.ts             # 설정 탭
│   ├── core/
│   │   ├── FileManager.ts      # 파일 저장/이동/삭제
│   │   ├── HashService.ts      # 해시 계산/캐싱
│   │   ├── LinkUpdater.ts      # 링크 자동 업데이트
│   │   └── OrphanDetector.ts   # 고아 이미지 감지
│   ├── ui/
│   │   ├── GalleryView.tsx     # 메인 갤러리 뷰
│   │   ├── components/
│   │   │   ├── GalleryContainer.tsx  # 갤러리 메인 컨테이너
│   │   │   ├── ImageGrid.tsx         # 그리드 뷰 (다중 선택 지원)
│   │   │   ├── ImageList.tsx         # 리스트 뷰 (테이블 형식)
│   │   │   ├── InfoPanel.tsx         # 이미지 정보 패널
│   │   │   ├── FilterTabs.tsx        # 필터 탭 (전체/사용중/고아)
│   │   │   ├── ActionToolbar.tsx     # 벌크 작업 툴바
│   │   │   ├── ViewModeToggle.tsx    # 그리드/리스트 뷰 전환
│   │   │   └── SortDropdown.tsx      # 정렬 드롭다운
│   │   └── modals/
│   │       └── FolderSuggestModal.ts # 폴더 선택 모달
│   └── types/                  # TypeScript 타입 정의
├── styles/                     # CSS 스타일
├── manifest.json
├── package.json
└── esbuild.config.mjs
```

---

## 6. 키보드 단축키

| 단축키 | 동작 |
|--------|------|
| `Ctrl/Cmd + Shift + G` | 갤러리 열기 |
| 갤러리 내 `Arrow` | 이미지 탐색 |
| 갤러리 내 `Enter` / `Space` | 이미지 선택 |
| 갤러리 내 `Delete` / `Backspace` | 선택된 고아 이미지 삭제 |
| 갤러리 내 `Ctrl/Cmd + A` | 전체 선택 |
| 갤러리 내 `Escape` | 선택 해제 |
| 갤러리 내 `I` | 정보 패널 토글 |
| `Ctrl/Cmd + 클릭` | 다중 선택 토글 |
| `Shift + 클릭` | 범위 선택 |

---

## 7. Post-MVP 확장 계획

1. **클라우드 동기화**: S3, Dropbox 연동
2. **이미지 편집**: 자르기, 회전, 리사이즈, 압축
3. **OCR**: 이미지 내 텍스트 추출 및 검색
4. **고급 필터**: 태그, 날짜, 해상도 필터링
5. **모바일 최적화**: Obsidian Mobile 지원

---

## 변경 이력

| 버전 | 날짜 | 변경 내용 |
|------|------|----------|
| 1.0 | 2025.12.25 | 초기 개발 계획서 작성 |
| 2.0 | 2026.01.12 | PRD로 전환, React 적용, 성능/설정/테스트 전략 보완 |
| 2.1 | 2026.01.12 | 이미지 저장 구조 및 노트 연동 전략 섹션 추가 |
| 2.2 | 2026.01.12 | "폴더 기반" 저장 모드를 기본값으로 추가, MVP 구현 완료 |
| 2.3 | 2026.01.13 | 갤러리 UX 개선: 다중 선택, 리스트 뷰, 벌크 작업, 정렬 기능 추가 |
